# 世界地図パズルゲーム 要件定義書

## 1. プロジェクト概要

### 1.1 目的
ブラウザ上で動作する世界地図パズルゲームを開発する。プレイヤーが国のピースを正しい位置にドラッグ&ドロップして世界地図を完成させる教育的エンターテインメント。

### 1.2 技術スタック
- HTML5 / CSS3 / JavaScript（バニラ）
- 単一HTMLファイルで完結（外部依存なし）
- Canvas または SVG で地図を描画

---

## 2. ゲームモード

### 2.1 地域別モード
プレイヤーが地域を選んでプレイする。

| 地域 | 国数（目安） |
|------|-------------|
| アジア | 15〜20 |
| ヨーロッパ | 15〜20 |
| アフリカ | 15〜20 |
| 北米・中米 | 10〜15 |
| 南米 | 10〜12 |
| オセアニア | 5〜8 |
| 全世界 | 全地域合算 |

### 2.2 難易度設定

| 難易度 | 内容 |
|--------|------|
| かんたん | 国名ラベル表示＋正解位置にガイド（薄い輪郭）表示＋ヒント無制限 |
| ふつう | 正解位置にガイド表示＋ヒント3回まで |
| むずかしい | ガイドなし＋ヒントなし＋タイムアタック |

---

## 3. 機能要件

### 3.1 コア機能

#### 3.1.1 地図表示
- SVGベースで各国の形状を簡略化したポリゴンで表現する
- ズーム（拡大・縮小）とパン（地図のスクロール）に対応する
- 正解済みの国は地図上に色付きで固定表示する

#### 3.1.2 パズル操作
- 画面下部またはサイドバーに未配置の国ピースを一覧表示する
- ピースをドラッグ&ドロップで地図上の正しい位置に配置する
- 正しい位置付近にドロップした場合、スナップ（自動吸着）する
- 間違った位置にドロップした場合、ピースは一覧に戻る
- タッチデバイス（スマホ・タブレット）のタッチ操作に対応する

#### 3.1.3 ヒント機能
- ヒントボタンを押すと、選択中の国の正しい位置がハイライトされる
- 難易度に応じてヒント回数を制限する

#### 3.1.4 スコアリング
- 基礎点: 国を正しく配置すると加算（国の面積・難易度で変動）
- 時間ボーナス: 早くクリアするほど高得点
- 正確性ボーナス: ミス（間違った位置へのドロップ）が少ないほど高得点
- ヒント使用: ヒント使用でその国のスコアが減算

### 3.2 UI/UX

#### 3.2.1 画面構成

```
+--------------------------------------------------+
|  ロゴ   | 地域選択 | 難易度 | タイマー | スコア   |
+--------------------------------------------------+
|                                                    |
|                                                    |
|              メイン地図エリア                        |
|           （ズーム・パン可能）                       |
|                                                    |
|                                                    |
+--------------------------------------------------+
|  未配置の国ピース一覧（横スクロール）                 |
|  [国A] [国B] [国C] [国D] ...                       |
+--------------------------------------------------+
|  ヒント | 進捗 12/45  | リセット                    |
+--------------------------------------------------+
```

#### 3.2.2 ビジュアル
- 配色: ダークテーマ（背景: 海は濃紺、大陸は暗めのグレー）
- 正解済みの国: 地域ごとに色分け（アジア=緑系、ヨーロッパ=青系など）
- ドラッグ中のピース: 半透明＋拡大表示＋影エフェクト
- 正解時: パーティクル演出＋国名表示アニメーション
- 全完成時: 祝福アニメーション＋最終スコア表示

#### 3.2.3 レスポンシブ対応
- PC: 横レイアウト（地図が大きく表示）
- タブレット: 横レイアウト（ピース一覧は下部）
- スマホ: 縦レイアウト（ズーム操作必須、ピンチ対応）

### 3.3 学習要素

#### 3.3.1 国情報表示
- ピースにホバーまたはタップすると以下の情報をツールチップで表示:
  - 国名（日本語 + 英語）
  - 首都
  - 人口（概算）
  - 面積（概算）

#### 3.3.2 進捗トラッキング
- localStorageを使い、各地域のベストスコア・クリアタイムを保存する
- 地域選択画面にクリア状況を表示する（星評価: ★☆☆ 〜 ★★★）

---

## 4. 非機能要件

### 4.1 パフォーマンス
- 初期ロード: 3秒以内（単一ファイルのため）
- ドラッグ操作: 60fps維持
- SVGノード数を最小限に抑え、簡略化したポリゴンを使用する

### 4.2 対応ブラウザ
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### 4.3 制約事項
- 単一HTMLファイルで完結させる（外部CDN・API不使用）
- 地図データはJavaScript内にインラインで埋め込む
- 国の形状は簡略化ポリゴン（頂点数を抑えてファイルサイズ削減）

---

## 5. 地図データ方針

### 5.1 座標系
- メルカトル図法ベースの簡易座標を使用
- 経度: -180〜180 → canvas上のX座標に変換
- 緯度: -60〜85 → canvas上のY座標に変換

### 5.2 国の形状データ
- 主要国は実際の形状を簡略化した多角形で表現
- 各国のポリゴンデータ（頂点座標配列）をJSオブジェクトとして定義
- 島嶼部は主要な島のみ表現（小さい離島は省略）
- ファイルサイズ目標: 全体で500KB以内

---

## 6. 開発フェーズ

### Phase 1: 基盤（MVP）
- [ ] 地図描画エンジン（SVG/Canvas）
- [ ] 1地域分の国データ作成（アジア）
- [ ] ドラッグ&ドロップの基本実装
- [ ] スナップ判定ロジック
- [ ] 基本UI（ヘッダー、ピース一覧、地図エリア）

### Phase 2: ゲーム性
- [ ] スコアリングシステム
- [ ] タイマー
- [ ] 難易度選択
- [ ] ヒント機能
- [ ] 正解時・完成時の演出

### Phase 3: コンテンツ拡充
- [ ] 全地域の国データ作成
- [ ] 国情報（首都・人口など）の追加
- [ ] localStorage による進捗保存

### Phase 4: 仕上げ
- [ ] レスポンシブ対応
- [ ] タッチ操作最適化
- [ ] パフォーマンス最適化
- [ ] テスト・デバッグ

---

## 7. リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| 地図データのファイルサイズ肥大 | 読み込み遅延 | ポリゴン頂点数を制限（1国あたり最大50頂点） |
| 小さい国のタップが困難 | UX低下 | ズーム機能＋タップ領域の拡大判定 |
| 国境の精度不足 | 見た目の違和感 | 隣接国と頂点を共有して隙間を防ぐ |
| 単一ファイルの保守性 | 開発効率低下 | JSセクションを明確に分割しコメントで区切る |
